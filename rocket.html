<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rocket - Casino Gift Contract</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="style.css">
    <style>
        .rocket-container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .rocket-header {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .rocket-canvas {
            width: 100%;
            height: 300px;
            background: linear-gradient(180deg, #0d1117 0%, #1a1f2e 100%);
            border-radius: 15px;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
            border: 2px solid rgba(255, 255, 255, 0.1);
        }
        
        .rocket {
            position: absolute;
            bottom: 50px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 40px;
            transition: bottom 0.1s linear;
        }
        
        .multiplier-display {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 24px;
            font-weight: bold;
            color: #00b894;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px 20px;
            border-radius: 20px;
        }
        
        .bet-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .bet-input {
            flex: 1;
            padding: 12px;
            background: rgba(35, 40, 52, 0.8);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            color: white;
            font-size: 16px;
            min-width: 120px;
        }
        
        .place-bet-btn {
            padding: 12px 20px;
            background: linear-gradient(135deg, #00b894, #008066);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
        }
        
        .place-bet-btn:disabled {
            background: #666;
            cursor: not-allowed;
        }
        
        .cashout-btn {
            padding: 12px 20px;
            background: linear-gradient(135deg, #fdcb6e, #e6a336);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
        }
        
        .cashout-btn:disabled {
            background: #666;
            cursor: not-allowed;
        }
        
        .game-info {
            background: rgba(25, 30, 42, 0.8);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .info-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        
        .bets-list {
            background: rgba(25, 30, 42, 0.8);
            border-radius: 15px;
            padding: 15px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .bet-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .bet-item:last-child {
            border-bottom: none;
        }
        
        .explosion {
            position: absolute;
            font-size: 60px;
            animation: explode 0.5s ease-out;
        }
        
        @keyframes explode {
            0% { transform: scale(0); opacity: 0; }
            50% { transform: scale(1.5); opacity: 1; }
            100% { transform: scale(2); opacity: 0; }
        }
        
        .trail {
            position: absolute;
            width: 2px;
            background: linear-gradient(to bottom, transparent, #ff6b6b);
            animation: trail 1s linear;
        }
        
        @keyframes trail {
            from { height: 0; opacity: 1; }
            to { height: 100px; opacity: 0; }
        }

        .game-stats {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            padding: 10px;
            background: rgba(25, 30, 42, 0.8);
            border-radius: 10px;
        }

        .stat-item {
            text-align: center;
            padding: 5px;
        }

        .stat-label {
            font-size: 12px;
            color: #a0a0a0;
            margin-bottom: 3px;
        }

        .stat-value {
            font-size: 14px;
            font-weight: bold;
            color: #74b9ff;
        }

        .timer-value {
            color: #fdcb6e;
        }

        .players-value {
            color: #00b894;
        }

        .bot-avatar {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            display: inline-block;
            margin-right: 8px;
            text-align: center;
            line-height: 20px;
            font-size: 12px;
        }

        .user-bet {
            background: rgba(0, 184, 148, 0.2);
            border-left: 3px solid #00b894;
        }
    </style>
</head>
<body>
    <div class="container">
        <button class="back-button" onclick="goBack()">‚Üê –ù–∞–∑–∞–¥</button>
        
        <div class="rocket-header">
            <h1>üöÄ Rocket Game</h1>
            <div class="balance">
                –ë–∞–ª–∞–Ω—Å: <span id="balance">0</span> TON
                <span id="demo-badge" style="margin-left: 10px; padding: 2px 8px; background: #ffc107; border-radius: 10px; font-size: 12px;">TESTNET</span>
            </div>
        </div>

        <div class="game-stats">
            <div class="stat-item">
                <div class="stat-label">–ò–≥—Ä–æ–∫–æ–≤ –æ–Ω–ª–∞–π–Ω</div>
                <div class="stat-value players-value" id="playersCount">1</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">–°–ª–µ–¥—É—é—â–∏–π —Ä–∞—É–Ω–¥</div>
                <div class="stat-value timer-value" id="roundTimer">10—Å</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">–ê–∫—Ç–∏–≤–Ω—ã—Ö —Å—Ç–∞–≤–æ–∫</div>
                <div class="stat-value" id="activeBetsCount">0</div>
            </div>
        </div>

        <div class="rocket-container">
            <div class="rocket-canvas" id="rocketCanvas">
                <div class="multiplier-display" id="multiplierDisplay">1.00x</div>
                <div class="rocket" id="rocket">üöÄ</div>
            </div>

            <div class="bet-controls">
                <input type="number" class="bet-input" id="betAmount" min="1" max="50" step="1" value="1" placeholder="–°—Ç–∞–≤–∫–∞ –≤ TON">
                <button class="place-bet-btn" id="placeBetBtn">–ü–æ—Å—Ç–∞–≤–∏—Ç—å</button>
                <button class="cashout-btn" id="cashoutBtn" disabled>–ó–∞–±—Ä–∞—Ç—å</button>
            </div>

            <div class="game-info">
                <div class="info-row">
                    <span>–¢–≤–æ—è —Å—Ç–∞–≤–∫–∞:</span>
                    <span id="yourBet">0 TON</span>
                </div>
                <div class="info-row">
                    <span>–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π –≤—ã–∏–≥—Ä—ã—à:</span>
                    <span id="potentialWin">0 TON</span>
                </div>
                <div class="info-row">
                    <span>–¢–µ–∫—É—â–∏–π –º–Ω–æ–∂–∏—Ç–µ–ª—å:</span>
                    <span id="currentMultiplier">1.00x</span>
                </div>
            </div>

            <div class="bets-list">
                <h3>–ê–∫—Ç–∏–≤–Ω—ã–µ —Å—Ç–∞–≤–∫–∏</h3>
                <div id="betsContainer">
                    <div class="no-bets">–°—Ç–∞–≤–æ–∫ –ø–æ–∫–∞ –Ω–µ—Ç</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentGame = null;
        let isDemoMode = true;
        let userData = null;
        let rocketInterval = null;
        let currentMultiplier = 1.00;
        let userBet = null;
        let activePlayers = 1;
        let lastExplosionMultiplier = 1.0;
        let roundTimer = 10;
        let timerInterval = null;
        let botBetsInterval = null;
        let activeBots = [];
        let gameRound = 1;

        // –°–ø–∏—Å–æ–∫ –±–æ—Ç–æ–≤ —Å —Ä–∞–∑–Ω—ã–º–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è–º–∏
        const bots = [
            { name: "CryptoPro", strategy: "aggressive", avatar: "ü§ñ" },
            { name: "TonMaster", strategy: "conservative", avatar: "üëæ" },
            { name: "RocketKing", strategy: "moderate", avatar: "ü¶æ" },
            { name: "CryptoWhale", strategy: "aggressive", avatar: "üêã" },
            { name: "TonInvestor", strategy: "conservative", avatar: "üíº" },
            { name: "SpaceTraveler", strategy: "moderate", avatar: "üë®‚ÄçüöÄ" },
            { name: "MoonRacer", strategy: "aggressive", avatar: "üåô" },
            { name: "StarGazer", strategy: "conservative", avatar: "‚≠ê" },
            { name: "CryptoNinja", strategy: "moderate", avatar: "ü•∑" },
            { name: "BlockchainPro", strategy: "aggressive", avatar: "‚õìÔ∏è" }
        ];

        // –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∫—ç—à–∞—É—Ç–∞ –¥–ª—è –±–æ—Ç–æ–≤ (–≤ x)
        const botStrategies = {
            conservative: { min: 1.5, max: 3.0 },
            moderate: { min: 2.0, max: 5.0 },
            aggressive: { min: 3.0, max: 8.0 }
        };

        document.addEventListener('DOMContentLoaded', function() {
            loadUserData();
            setupEventListeners();
            startBotActivity();
            updatePlayersCount(3 + Math.floor(Math.random() * 8)); // 3-10 –∏–≥—Ä–æ–∫–æ–≤ –æ–Ω–ª–∞–π–Ω
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –ø–µ—Ä–≤—ã–π —Ä–∞—É–Ω–¥ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
            setTimeout(startNewRound, 5000);
        });

        function goBack() {
            window.location.href = 'index.html';
        }

        async function loadUserData() {
            try {
                const tg = window.Telegram.WebApp;
                if (tg.initDataUnsafe && tg.initDataUnsafe.user) {
                    const telegramId = tg.initDataUnsafe.user.id;
                    
                    const response = await fetch(`/api/user/${telegramId}`);
                    if (response.ok) {
                        userData = await response.json();
                        document.getElementById('balance').textContent = userData.balance.toFixed(2);
                        isDemoMode = userData.demo_mode;
                        document.getElementById('demo-badge').textContent = isDemoMode ? 'TESTNET' : 'MAINNET';
                    }
                }
            } catch (error) {
                console.error('Error loading user data:', error);
            }
        }

        function setupEventListeners() {
            document.getElementById('placeBetBtn').addEventListener('click', placeBet);
            document.getElementById('cashoutBtn').addEventListener('click', cashout);
        }

        function startNewRound() {
            clearInterval(timerInterval);
            roundTimer = 10;
            updateRoundTimer();
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –±–æ—Ç–æ–≤ –¥–ª—è —ç—Ç–æ–≥–æ —Ä–∞—É–Ω–¥–∞ (3-6 –±–æ—Ç–æ–≤)
            const botsInRound = 3 + Math.floor(Math.random() * 4);
            activeBots = [];
            
            for (let i = 0; i < botsInRound; i++) {
                const bot = {...bots[Math.floor(Math.random() * bots.length)]};
                bot.betAmount = generateBotBet(bot.strategy);
                bot.cashoutMultiplier = generateCashoutPoint(bot.strategy);
                bot.id = 'bot-' + Date.now() + '-' + i;
                activeBots.push(bot);
                
                // –ë–æ—Ç –¥–µ–ª–∞–µ—Ç —Å—Ç–∞–≤–∫—É
                addBotBet(bot);
            }
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—Ä —Ä–∞—É–Ω–¥–∞
            timerInterval = setInterval(() => {
                roundTimer--;
                updateRoundTimer();
                
                if (roundTimer <= 0) {
                    clearInterval(timerInterval);
                    startGame();
                }
            }, 1000);
        }

        function generateBotBet(strategy) {
            const baseAmount = {
                conservative: 1 + Math.random() * 4,   // 1-5 TON
                moderate: 2 + Math.random() * 8,       // 2-10 TON
                aggressive: 5 + Math.random() * 15     // 5-20 TON
            }[strategy];
            
            return Math.round(baseAmount);
        }

        function generateCashoutPoint(strategy) {
            const strategyRange = botStrategies[strategy];
            return strategyRange.min + Math.random() * (strategyRange.max - strategyRange.min);
        }

        function addBotBet(bot) {
            const betsContainer = document.getElementById('betsContainer');
            const noBets = betsContainer.querySelector('.no-bets');
            if (noBets) noBets.remove();
            
            const betItem = document.createElement('div');
            betItem.className = 'bet-item';
            betItem.id = bot.id;
            betItem.innerHTML = `
                <span><span class="bot-avatar">${bot.avatar}</span>${bot.name}</span>
                <span>${bot.betAmount} TON</span>
            `;
            
            betsContainer.appendChild(betItem);
            updateBetsCount();
        }

        function updateBotsCashout() {
            activeBots.forEach(bot => {
                if (currentMultiplier >= bot.cashoutMultiplier) {
                    // –ë–æ—Ç –∑–∞–±–∏—Ä–∞–µ—Ç –≤—ã–∏–≥—Ä—ã—à
                    cashoutBot(bot);
                }
            });
        }

        function cashoutBot(bot) {
            const winAmount = bot.betAmount * currentMultiplier;
            const betElement = document.getElementById(bot.id);
            
            if (betElement) {
                betElement.innerHTML = `
                    <span><span class="bot-avatar">${bot.avatar}</span>${bot.name}</span>
                    <span style="color: #00b894;">+${winAmount.toFixed(2)} TON (${currentMultiplier.toFixed(2)}x)</span>
                `;
                
                // –£–¥–∞–ª—è–µ–º –±–æ—Ç–∞ –∏–∑ –∞–∫—Ç–∏–≤–Ω—ã—Ö —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
                setTimeout(() => {
                    if (betElement.parentNode) {
                        betElement.parentNode.removeChild(betElement);
                    }
                    activeBots = activeBots.filter(b => b.id !== bot.id);
                    updateBetsCount();
                }, 2000);
            }
        }

        function startBotActivity() {
            // –ë–æ—Ç—ã –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω—è—é—Ç—Å—è –∫ –∏–≥—Ä–µ
            botBetsInterval = setInterval(() => {
                if (Math.random() < 0.4 && activeBots.length < 8) {
                    const newBot = {...bots[Math.floor(Math.random() * bots.length)]};
                    newBot.betAmount = generateBotBet(newBot.strategy);
                    newBot.cashoutMultiplier = generateCashoutPoint(newBot.strategy);
                    newBot.id = 'bot-' + Date.now() + '-' + Math.random();
                    activeBots.push(newBot);
                    
                    addBotBet(newBot);
                    updatePlayersCount(activePlayers + 1);
                }
            }, 8000);
        }

        async function placeBet() {
            if (timerInterval) {
                alert('–ò–¥–µ—Ç –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ —Ä–∞—É–Ω–¥—É! –ü–æ–¥–æ–∂–¥–∏—Ç–µ ' + roundTimer + ' —Å–µ–∫—É–Ω–¥');
                return;
            }

            if (currentGame) {
                alert('–†–∞—É–Ω–¥ —É–∂–µ –Ω–∞—á–∞–ª—Å—è!');
                return;
            }

            const betAmount = parseFloat(document.getElementById('betAmount').value);
            
            if (betAmount < 1 || betAmount > 50) {
                alert('–°—Ç–∞–≤–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—Ç 1 –¥–æ 50 TON');
                return;
            }

            try {
                const tg = window.Telegram.WebApp;
                const telegramId = tg.initDataUnsafe.user.id;

                const response = await fetch('/api/rocket/place-bet', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        telegramId: telegramId,
                        betAmount: betAmount,
                        demoMode: isDemoMode
                    })
                });

                const result = await response.json();
                
                if (!response.ok) {
                    alert(result.error || '–û—à–∏–±–∫–∞ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è —Å—Ç–∞–≤–∫–∏');
                    return;
                }

                if (result.success) {
                    userBet = {
                        betId: result.betId,
                        amount: betAmount,
                        cashoutMultiplier: 1.00
                    };

                    document.getElementById('yourBet').textContent = betAmount + ' TON';
                    document.getElementById('placeBetBtn').disabled = true;
                    document.getElementById('cashoutBtn').disabled = false;

                    // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∞–≤–∫—É –≤ —Å–ø–∏—Å–æ–∫
                    const betsContainer = document.getElementById('betsContainer');
                    const noBets = betsContainer.querySelector('.no-bets');
                    if (noBets) noBets.remove();
                    
                    const betItem = document.createElement('div');
                    betItem.className = 'bet-item user-bet';
                    betItem.id = 'user-bet';
                    betItem.innerHTML = `
                        <span>üë§ –í—ã</span>
                        <span>${betAmount} TON</span>
                    `;
                    
                    betsContainer.appendChild(betItem);
                    updateBetsCount();
                    
                    updatePlayersCount(activePlayers + 1);
                }
            } catch (error) {
                console.error('Error placing bet:', error);
                alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è');
            }
        }

        function startGame() {
            if (currentGame) return;

            currentGame = {
                startTime: Date.now(),
                explosionPoint: 1.0 + Math.random() * 9.0  // –í–∑—Ä—ã–≤ –º–µ–∂–¥—É 1x –∏ 10x
            };

            currentMultiplier = 1.00;
            updateMultiplierDisplay();

            rocketInterval = setInterval(updateRocket, 100);
        }

        function updateRocket() {
            if (!currentGame) return;

            // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –º–Ω–æ–∂–∏—Ç–µ–ª—å (–Ω–µ–º–Ω–æ–≥–æ —Å–ª—É—á–∞–π–Ω–æ—Å—Ç–∏ –¥–ª—è —Ä–µ–∞–ª–∏–∑–º–∞)
            const increment = 0.05 + Math.random() * 0.1;
            currentMultiplier += increment;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            updateMultiplierDisplay();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é —Ä–∞–∫–µ—Ç—ã
            const rocket = document.getElementById('rocket');
            const canvasHeight = document.getElementById('rocketCanvas').offsetHeight;
            const maxHeight = canvasHeight - 100;
            const rocketHeight = maxHeight * (1 - (currentMultiplier - 1) / 9);
            
            rocket.style.bottom = Math.max(50, rocketHeight) + 'px';
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Å–ª–µ–¥
            addRocketTrail();
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–∑—Ä—ã–≤
            if (currentMultiplier >= currentGame.explosionPoint) {
                endGame();
                return;
            }
            
            // –ë–æ—Ç—ã —Ä–µ—à–∞—é—Ç, –∑–∞–±–∏—Ä–∞—Ç—å –ª–∏ –≤—ã–∏–≥—Ä—ã—à
            updateBotsCashout();
        }

        function addRocketTrail() {
            const rocket = document.getElementById('rocket');
            const rocketRect = rocket.getBoundingClientRect();
            const canvasRect = document.getElementById('rocketCanvas').getBoundingClientRect();
            
            const trail = document.createElement('div');
            trail.className = 'trail';
            trail.style.left = (rocketRect.left - canvasRect.left + rocketRect.width / 2) + 'px';
            trail.style.bottom = (rocketRect.bottom - canvasRect.bottom) + 'px';
            
            document.getElementById('rocketCanvas').appendChild(trail);
            
            setTimeout(() => {
                if (trail.parentNode) {
                    trail.parentNode.removeChild(trail);
                }
            }, 1000);
        }

        function endGame() {
            clearInterval(rocketInterval);
            rocketInterval = null;
            
            lastExplosionMultiplier = currentMultiplier;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤–∑—Ä—ã–≤
            const rocket = document.getElementById('rocket');
            const explosion = document.createElement('div');
            explosion.className = 'explosion';
            explosion.textContent = 'üí•';
            explosion.style.left = rocket.style.left;
            explosion.style.bottom = rocket.style.bottom;
            
            document.getElementById('rocketCanvas').appendChild(explosion);
            
            setTimeout(() => {
                if (explosion.parentNode) {
                    explosion.parentNode.removeChild(explosion);
                }
            }, 500);
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–±–∏—Ä–∞–µ–º –≤—ã–∏–≥—Ä—ã—à –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –µ—Å–ª–∏ –æ–Ω –Ω–µ —É—Å–ø–µ–ª
            if (userBet) {
                cashout(true);
            }
            
            // –ó–∞–±–∏—Ä–∞–µ–º –≤—ã–∏–≥—Ä—ã—à–∏ —É –≤—Å–µ—Ö –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è –±–æ—Ç–æ–≤
            activeBots.forEach(bot => cashoutBot(bot));
            
            // –û—á–∏—â–∞–µ–º –∏–≥—Ä—É
            currentGame = null;
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –Ω–æ–≤—ã–π —Ä–∞—É–Ω–¥ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
            setTimeout(() => {
                resetGame();
                startNewRound();
            }, 5000);
        }

        async function cashout(auto = false) {
            if (!userBet) return;

            try {
                const tg = window.Telegram.WebApp;
                const telegramId = tg.initDataUnsafe.user.id;

                const response = await fetch('/api/rocket/cashout', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        telegramId: telegramId,
                        betId: userBet.betId,
                        multiplier: currentMultiplier,
                        demoMode: isDemoMode
                    })
                });

                const result = await response.json();
                
                if (!response.ok) {
                    alert(result.error || '–û—à–∏–±–∫–∞ –≤—ã–≤–æ–¥–∞ —Å—Ä–µ–¥—Å—Ç–≤');
                    return;
                }

                if (result.success) {
                    const winAmount = userBet.amount * currentMultiplier;
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º UI
                    const userBetElement = document.getElementById('user-bet');
                    if (userBetElement) {
                        userBetElement.innerHTML = `
                            <span>üë§ –í—ã</span>
                            <span style="color: #00b894;">+${winAmount.toFixed(2)} TON (${currentMultiplier.toFixed(2)}x)</span>
                        `;
                    }
                    
                    document.getElementById('yourBet').textContent = '0 TON';
                    document.getElementById('potentialWin').textContent = '0 TON';
                    document.getElementById('placeBetBtn').disabled = false;
                    document.getElementById('cashoutBtn').disabled = true;
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å
                    if (userData) {
                        userData.balance = result.newBalance;
                        document.getElementById('balance').textContent = userData.balance.toFixed(2);
                    }
                    
                    userBet = null;
                    updatePlayersCount(activePlayers - 1);
                    
                    setTimeout(() => {
                        if (userBetElement && userBetElement.parentNode) {
                            userBetElement.parentNode.removeChild(userBetElement);
                            updateBetsCount();
                        }
                    }, 2000);
                }
            } catch (error) {
                console.error('Error cashing out:', error);
                alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è');
            }
        }

        function resetGame() {
            clearInterval(rocketInterval);
            rocketInterval = null;
            currentGame = null;
            currentMultiplier = 1.00;
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ä–∞–∫–µ—Ç—É
            const rocket = document.getElementById('rocket');
            rocket.style.bottom = '50px';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            updateMultiplierDisplay();
            document.getElementById('yourBet').textContent = '0 TON';
            document.getElementById('potentialWin').textContent = '0 TON';
            document.getElementById('placeBetBtn').disabled = false;
            document.getElementById('cashoutBtn').disabled = true;
            
            // –û—á–∏—â–∞–µ–º —Å–ø–∏—Å–æ–∫ —Å—Ç–∞–≤–æ–∫ (–∫—Ä–æ–º–µ –±–æ—Ç–æ–≤)
            const betsContainer = document.getElementById('betsContainer');
            const userBetElement = document.getElementById('user-bet');
            if (userBetElement) {
                betsContainer.removeChild(userBetElement);
            }
            
            userBet = null;
            gameRound++;
        }

        function updateMultiplierDisplay() {
            document.getElementById('multiplierDisplay').textContent = currentMultiplier.toFixed(2) + 'x';
            document.getElementById('currentMultiplier').textContent = currentMultiplier.toFixed(2) + 'x';
            
            if (userBet) {
                const potentialWin = userBet.amount * currentMultiplier;
                document.getElementById('potentialWin').textContent = potentialWin.toFixed(2) + ' TON';
            }
        }

        function updatePlayersCount(count) {
            activePlayers = count;
            document.getElementById('playersCount').textContent = count;
        }

        function updateBetsCount() {
            const betsContainer = document.getElementById('betsContainer');
            const betCount = betsContainer.querySelectorAll('.bet-item').length;
            document.getElementById('activeBetsCount').textContent = betCount;
            
            if (betCount === 0) {
                const noBets = document.createElement('div');
                noBets.className = 'no-bets';
                noBets.textContent = '–°—Ç–∞–≤–æ–∫ –ø–æ–∫–∞ –Ω–µ—Ç';
                betsContainer.appendChild(noBets);
            }
        }

        function updateRoundTimer() {
            document.getElementById('roundTimer').textContent = roundTimer + '—Å';
        }
    </script>
</body>
</html>